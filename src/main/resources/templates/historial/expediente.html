<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Expediente Clínico</title>
</head>
<body>

<div layout:fragment="content">

    <!-- Encabezado con datos del paciente -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 mb-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-3xl mr-4">
                    <i class="fa-solid fa-dog" th:if="${mascota.raza.especie.nombreEspecie == 'Canino'}"></i>
                    <i class="fa-solid fa-cat" th:if="${mascota.raza.especie.nombreEspecie == 'Felino'}"></i>
                    <i class="fa-solid fa-paw" th:unless="${mascota.raza.especie.nombreEspecie == 'Canino' || mascota.raza.especie.nombreEspecie == 'Felino'}"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900" th:text="${mascota.nombre}">Nombre Mascota</h1>
                    <p class="text-gray-500 text-sm">
                        <span th:text="${mascota.raza.especie.nombreEspecie} + ' - ' + ${mascota.raza.nombreRaza}">Raza</span>
                        | Edad: <span th:text="${mascota.fechaNacimiento}">Fecha</span>
                    </p>
                </div>
            </div>
            <div class="flex space-x-3">
                <a th:href="@{/mascotas/editar/{id}(id=${mascota.idMascota})}" class="text-gray-600 hover:text-blue-600 border px-3 py-2 rounded-md text-sm">
                    <i class="fa-solid fa-pen mr-1"></i> Editar Datos
                </a>
                <a th:href="@{/historial/nuevo/{id}(id=${mascota.idMascota})}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md shadow-sm text-sm font-medium transition-colors">
                    <i class="fa-solid fa-stethoscope mr-2"></i> Nueva Consulta
                </a>
            </div>
        </div>

        <hr class="my-4 border-gray-100">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div>
                <span class="block text-gray-400 text-xs uppercase tracking-wider">Propietario</span>
                <span class="font-medium text-gray-800" th:text="${mascota.propietario.persona.nombres} + ' ' + ${mascota.propietario.persona.apellidos}">Nombre Dueño</span>
            </div>
            <div>
                <span class="block text-gray-400 text-xs uppercase tracking-wider">Contacto</span>
                <span class="font-medium text-gray-800" th:text="${mascota.propietario.persona.telefono}">Teléfono</span>
            </div>
            <div>
                <span class="block text-gray-400 text-xs uppercase tracking-wider">Total Consultas</span>
                <span class="font-medium text-blue-600" th:text="${#lists.size(historial)}">0</span>
            </div>
        </div>
    </div>

    <!-- Línea de Tiempo del Historial -->
    <div class="space-y-6">
        <h3 class="text-lg font-bold text-gray-700 ml-2">Historial de Atenciones</h3>

        <div th:each="consulta : ${historial}" class="relative pl-8 sm:pl-32 py-2 group">
            <!-- Línea vertical -->
            <div class="flex flex-col sm:flex-row items-start mb-1 group-last:before:hidden before:absolute before:left-2 sm:before:left-0 before:h-full before:px-px before:bg-slate-200 sm:before:ml-[6.5rem] before:self-start before:-translate-x-1/2 before:translate-y-3 after:absolute after:left-2 sm:after:left-0 after:w-2 after:h-2 after:bg-blue-600 after:border-4 after:box-content after:border-slate-50 after:rounded-full sm:after:ml-[6.5rem] after:-translate-x-1/2 after:translate-y-1.5">
                <time class="sm:absolute left-0 translate-y-0.5 inline-flex items-center justify-center text-xs font-semibold uppercase w-20 h-6 mb-3 sm:mb-0 text-emerald-600 bg-emerald-100 rounded-full"
                      th:text="${#temporals.format(consulta.fechaConsulta, 'dd MMM yyyy')}">Fecha</time>

                <div class="text-xl font-bold text-slate-900" th:text="${consulta.diagnostico}">Diagnóstico</div>
            </div>

            <!-- Contenido de la tarjeta -->
            <div class="text-slate-500 bg-white p-4 rounded-lg border border-gray-200 shadow-sm mt-2">
                <p class="mb-2" th:text="${consulta.observaciones}">Detalles del tratamiento y observaciones...</p>

                <div class="mt-3 flex items-center justify-between border-t pt-3 border-gray-100">
                    <div class="flex items-center text-xs text-gray-400">
                        <i class="fa-solid fa-user-doctor mr-1"></i>
                        <span th:text="'Atendido por: ' + ${consulta.veterinario.persona.nombres}">Dr. Veterinario</span>
                    </div>
                    <span class="text-xs text-gray-400" th:text="${#temporals.format(consulta.fechaConsulta, 'HH:mm')} + ' hrs'">Hora</span>
                </div>
            </div>
        </div>

        <!-- Estado Vacío -->
        <div th:if="${#lists.isEmpty(historial)}" class="text-center py-10 bg-white rounded-lg border border-dashed border-gray-300">
            <i class="fa-solid fa-folder-open text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">No hay registros médicos para esta mascota.</p>
            <a th:href="@{/historial/nuevo/{id}(id=${mascota.idMascota})}" class="text-blue-600 hover:underline text-sm mt-2 block">
                Registrar la primera consulta
            </a>
        </div>
    </div>

</div>

</body>
</html>